const editor = document.getElementById('editor');
const previewContent = document.getElementById('preview-content');
const documentNameInput = document.getElementById('document-name');
const saveButton = document.getElementById('save');
const loadDocumentSelect = document.getElementById('load-document');
const deleteButton = document.getElementById('delete-document');


editor.addEventListener('input', function () {
    const markdown = editor.value;
    previewContent.innerHTML = marked.parse(markdown);
});


saveButton.addEventListener('click', function () {
    const documentName = documentNameInput.value.trim();
    if (!documentName) {
        alert("Please enter a document name.");
        return;
    }

    const documentData = {
        name: documentName,
        content: editor.value,
        preview: previewContent.innerHTML,
    };

    localStorage.setItem(documentName, JSON.stringify(documentData));
    alert(`Document "${documentName}" saved!`);


    updateLoadDropdown();
});


loadDocumentSelect.addEventListener('change', function () {
    const documentName = loadDocumentSelect.value;
    if (!documentName) return;

    const documentData = JSON.parse(localStorage.getItem(documentName));
    if (documentData) {
        editor.value = documentData.content;
        previewContent.innerHTML = documentData.preview;
        documentNameInput.value = documentData.name;
    }
});


deleteButton.addEventListener('click', function () {
    const documentName = documentNameInput.value.trim();
    if (!documentName) {
        alert("Please enter a document name.");
        return;
    }

    if (confirm(`Are you sure you want to delete "${documentName}"?`)) {
        localStorage.removeItem(documentName);
        alert(`Document "${documentName}" deleted.`);
        editor.value = "";
        previewContent.innerHTML = "";
        documentNameInput.value = "";
        updateLoadDropdown();
    }
});


function updateLoadDropdown() {
    loadDocumentSelect.innerHTML = '<option value="">Load a saved document</option>';
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        const option = document.createElement('option');
        option.value = key;
        option.textContent = key;
        loadDocumentSelect.appendChild(option);
    }
}


updateLoadDropdown();